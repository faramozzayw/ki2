name: test:Deploy to cPanel

on:
  push:
    branches:
      - ci-patch-1

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Delete old useless files
        uses: appleboy/ssh-action@master
        env: 
          SKIP_FILES: ${{ secrets.SKIP_FILES }}
          TARGET_DIR: ${{ secrets.TARGET_DIR }}
          FAKE_TARGET_DIR: ${{ secrets.FAKE_TARGET_DIR }}
        with:
          host: ${{ secrets.HOST }}
          port: ${{ secrets.PORT }}
          username: ${{ secrets.USERNAME }}
          password: ${{ secrets.PASSWORD }}
          script_stop: true
          envs: SKIP_FILES,TARGET_DIR,TEST
          script: |
            printf "! -name %s " $(echo ${{ env.SKIP_FILES }})
            cd ${{ env.FAKE_TARGET_DIR }}
            find . -maxdepth 1 $(printf "! -name %s " $(echo ${{ env.SKIP_FILES }})) ! -name . ! -name .. 
            touch .artifact
